# all .profile customization are extracted to this file
# .profile contains following line
# source ~/.profile_custom

export PS1="\u@\h:\w>"

# python problem
# ValueError: unknown locale: UTF-8
# http://stackoverflow.com/questions/15526996/ipython-notebook-locale-error
# export LC_ALL=en_US.UTF-8
# export LANG=en_US.UTF-8
# or uncheck "Set locale variables automatically" at Terminal app preferences
# Terminal App -> Preferences -> Profiles -> Advanced -> Flag "Set locale variables automatically"

# [ shell ]
## Colorize the ls output ##
alias ls='ls -G '
## Use a long listing format ##
alias ll='ls -la '
## Show hidden files ##
alias l.='ls -d .* -G '
# cd
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias .....='cd ../../../..'
alias dockerpsn='docker ps --format="{{.Names}}"'
alias dockerpsn1='dockerpsn | head -n 1'
alias flush_dns='sudo killall -HUP mDNSResponder'
alias dangling_images='docker images -f "dangling=true" -q'
alias stopped_containers='docker ps -f "status=exited" -q'

# common
export DEVELOPMENT_HOME=$HOME/Development
export DEVELOPMENT_BIN=$DEVELOPMENT_HOME/bin
export DEVELOPMENT_SH=$DEVELOPMENT_HOME/sh
export HG_REPOS=$DEVELOPMENT_HOME/hg
export GIT_REPOS=$DEVELOPMENT_HOME/git

alias hgrepos="cd $HG_REPOS"
alias gitrepos="cd $GIT_REPOS"
alias devbin="cd $DEVELOPMENT_BIN"
alias devsh="cd $DEVELOPMENT_SH"
alias gitr='cd $(git root)'

# go lang
export GOROOT=$DEVELOPMENT_BIN/go
export GOPATH=$DEVELOPMENT_BIN/gopath

# path
MY_PATHS=(
    $HOME/bin
    $DEVELOPMENT_SH/mac
    $DEVELOPMENT_SH/nix
    $DEVELOPMENT_SH/nix/git-fire
    $DEVELOPMENT_SH/nix/git-recall
    $DEVELOPMENT_SH/nix/diff-so-fancy
)

# add all directories and directories referenced by symlinks
MY_PATHS+=($(find ${HOME}/bin -maxdepth 1 ! -path ${HOME}/bin -print0 | while IFS= read -r -d $'\0' file; do
                 if [ -L "$file" ]; then
                     real_path=$(readlink $file)
                     if test -e "$real_path"; then
                         if [ -d "$real_path" ]; then
                             echo "$real_path"
                         fi
                     fi
                 else
                     if [ -d "$file" ]; then
                         echo "$file"
                     fi
                 fi
             done))

function join {
    local IFS="$1"
    shift
    echo "$*"
}

function not_in_path {
    current_path=$1
    shift
    my_paths=$@

    i=0
    declare -a not_used=()

    for p in ${my_paths[@]}
    do
        if [[ $current_path != *$p* ]]; then
            not_used[$i]="$p"
            i=$((i + 1))
        fi
    done
    echo `join ":" "${not_used[@]}"`
}

MY_ADDITIONAL_PATHS=`not_in_path $PATH "${MY_PATHS[@]}"`
# patch PATH for terminal programs
if [ -n "$MY_ADDITIONAL_PATHS" ]; then
    export PATH=$MY_ADDITIONAL_PATHS:$PATH
fi
